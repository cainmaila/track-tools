(function(e){function t(t){for(var n,c,s=t[0],i=t[1],u=t[2],l=0,p=[];l<s.length;l++)c=s[l],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&p.push(a[c][0]),a[c]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);d&&d(t);while(p.length)p.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,s=1;s<r.length;s++){var i=r[s];0!==a[i]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},a={app:0},o=[];function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=i;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"0022":function(e,t,r){},"0aeb":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("7a23");function a(e,t,r,a,o,c){var s=Object(n["l"])("Poc");return Object(n["g"])(),Object(n["c"])(s)}r("b0c0");var o=function(e){return Object(n["i"])("data-v-33a5f599"),e=e(),Object(n["h"])(),e},c={class:"poc"},s=o((function(){return Object(n["e"])("hr",null,null,-1)})),i=o((function(){return Object(n["e"])("div",{class:"flex"},[Object(n["e"])("video",{muted:"",id:"vod",width:"460",height:"306"}),Object(n["e"])("video",{muted:"",id:"me-vod",width:"460",height:"306"})],-1)}));function u(e,t,r,a,o,u){return Object(n["g"])(),Object(n["d"])("div",c,[Object(n["e"])("div",null,Object(n["m"])(a.PEER_ID)+":"+Object(n["m"])(a.store.name),1),s,(Object(n["g"])(!0),Object(n["d"])(n["a"],null,Object(n["k"])(a.store.users,(function(e){return Object(n["g"])(),Object(n["d"])("div",{key:e.id},Object(n["m"])(e.displayName),1)})),128)),i])}var d=r("5530"),l=r("1da1"),p=(r("96cf"),r("99af"),r("d3b7"),r("3ca3"),r("ddb0"),r("9861"),r("ac1f"),r("841c"),r("2b3d"),r("4de4"),r("cedd")),m=r.n(p),f=r("ddfa"),b=r("9315"),g=r.n(b),v=~~(1e3*Math.random()),h="wss://dev.webrtc.anchorgo.io:4443/?roomId=".concat(new URLSearchParams(new URL(window.location.href).search).get("room")||"anchortech","&peerId=").concat(v),w={optional:[{googDscp:!0}]},j={name:"Poc",setup:function(){var e=Object(n["j"])({recvTransport:null,name:new URLSearchParams(new URL(window.location.href).search).get("name")||"No Name",users:null,track:null}),t=new m.a.WebSocketTransport(h),r=new m.a.Peer(t);return r.on("open",(function(){return console.log("#open")})),r.on("failed",(function(){return console.log("#failed")})),r.on("disconnected",(function(){return console.log("#disconnected")})),r.on("close",(function(){return console.log("#close")})),r.on("request",function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(r,n){var a,o,c,s,i,u,l,p,m,b,g,v,h,w,j,O,P,y,x,k;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("#request",r.method),"newConsumer"!==r.method){t.next=18;break}return a=r.data,o=a.peerId,c=a.producerId,s=a.id,i=a.kind,u=a.rtpParameters,l=a.appData,t.next=5,e.recvTransport.consume({id:s,producerId:c,kind:i,rtpParameters:u,appData:Object(d["a"])(Object(d["a"])({},l),{},{peerId:o})});case 5:p=t.sent,p.on("transportclose",(function(){console.log("#consumer-transportclose")})),m=f["parseScalabilityMode"](p.rtpParameters.encodings[0].scalabilityMode),b=m.spatialLayers,console.log("#spatialLayers",b,p),console.log("#視訊"),e.track=p.track,g=new MediaStream,g.addTrack(p.track),document.getElementById("vod").srcObject=g,document.getElementById("vod").play(),n(),t.next=28;break;case 18:if("newDataConsumer"!==r.method){t.next=28;break}return v=r.data,h=v.peerId,w=v.dataProducerId,j=v.id,O=v.sctpStreamParameters,P=v.label,y=v.protocol,x=v.appData,t.next=22,e.recvTransport.consumeData({id:j,dataProducerId:w,sctpStreamParameters:O,label:P,protocol:y,appData:Object(d["a"])(Object(d["a"])({},x),{},{peerId:h})});case 22:k=t.sent,k.on("transportclose",(function(){return console.log("#dataConsumer_transportclose")})),k.on("open",(function(e){return console.log("#dataConsumer_open",e)})),k.on("close",(function(){return console.log("#dataConsumer_close")})),k.on("error",(function(){return console.log("#dataConsumer_error")})),k.on("message",(function(){return console.log("#dataConsumer_message")}));case 28:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),r.on("notification",(function(t){switch(t.method){case"newPeer":console.log("#newPeer",t),e.users.push(t.data);break;case"peerClosed":console.log("#peerClosed",t),e.users=g()(e.users).filter((function(e){return e.id!=t.data.peerId})).toArray()||[];break;case"newConsumer":console.log("#newConsumer-xxxxxxx");break;case"downlinkBwe":case"activeSpeaker":break;default:console.log("#notification 未定義",t)}})),Object(n["f"])(Object(l["a"])(regeneratorRuntime.mark((function t(){var n,a,o,c,s,i,u,d,p,m,b,g,v,h,j,P,y,x,k;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O(1e3);case 2:return t.prev=2,n=new f["Device"]({handlerName:""}),t.next=6,r.request("getRouterRtpCapabilities");case 6:return a=t.sent,t.next=9,n.load({routerRtpCapabilities:a});case 9:return t.next=11,r.request("createWebRtcTransport",{forceTcp:!1,producing:!0,consuming:!1,sctpCapabilities:n.sctpCapabilities});case 11:return o=t.sent,c=o.id,s=o.iceParameters,i=o.iceCandidates,u=o.dtlsParameters,d=o.sctpParameters,p=n.createSendTransport({id:c,iceParameters:s,iceCandidates:i,dtlsParameters:u,sctpParameters:d,iceServers:[],proprietaryConstraints:w}),p.on("connect",(function(e,t,n){var a=e.dtlsParameters;console.log("#connect"),r.request("connectWebRtcTransport",{transportId:p.id,dtlsParameters:a}).then(t).catch(n)})),p.on("produce",function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t,n,a){var o,c,s,i,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=t.kind,c=t.rtpParameters,s=t.appData,console.log("#produce"),e.prev=2,e.next=5,r.request("produce",{transportId:p.id,kind:o,rtpParameters:c,appData:s});case 5:i=e.sent,u=i.id,n({id:u}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),a(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,n){return e.apply(this,arguments)}}()),p.on("producedata",(function(){return console.log("#producedata")})),p.on("connectionstatechange",(function(e){return console.log("#connectionstatechange",e)})),m=function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0});case 2:return t=e.sent,document.getElementById("me-vod").srcObject=t,document.getElementById("me-vod").play(),r=t.getVideoTracks()[0],e.next=8,p.produce({track:r});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m(),t.next=22,r.request("createWebRtcTransport",{forceTcp:!1,producing:!1,consuming:!0,sctpCapabilities:n.sctpCapabilities});case 22:return b=t.sent,g=b.id,v=b.iceParameters,h=b.iceCandidates,j=b.dtlsParameters,P=b.sctpParameters,y=n.createRecvTransport({id:g,iceParameters:v,iceCandidates:h,dtlsParameters:j,sctpParameters:P,iceServers:[]}),e.recvTransport=y,y.on("connect",(function(e,t,n){var a=e.dtlsParameters;console.log("#connect 2"),r.request("connectWebRtcTransport",{transportId:y.id,dtlsParameters:a}).then(t).catch(n)})),t.next=29,r.request("join",{displayName:e.name,device:{},rtpCapabilities:n.rtpCapabilities,sctpCapabilities:n.sctpCapabilities});case 29:x=t.sent,k=x.peers,console.log("#peers",k),e.users=k,t.next=38;break;case 35:t.prev=35,t.t0=t["catch"](2),console.error("#error",t.t0);case 38:case"end":return t.stop()}}),t,null,[[2,35]])})))),{PEER_ID:v,store:e}}};function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){setTimeout(t,e)}))}r("6795");var P=r("6b0d"),y=r.n(P);const x=y()(j,[["render",u],["__scopeId","data-v-33a5f599"]]);var k=x,C={name:"App",components:{Poc:k}};r("b33a");const R=y()(C,[["render",a]]);var I=R;Object(n["b"])(I).mount("#app")},6795:function(e,t,r){"use strict";r("0022")},b33a:function(e,t,r){"use strict";r("0aeb")}});
//# sourceMappingURL=app.ad5e6f2e.js.map
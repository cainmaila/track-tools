<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editor DEMO</title>
    <style>
      html {
        height: 100%;
      }
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #UI {
        position: absolute;
        top: 0px;
        left: 50%;
      }
    </style>
  </head>
  <body>
    <iframe
      id="Editor"
      src="./editor.html"
      frameborder="0"
      width="100%"
      height="100%"
    ></iframe>
    <div id="UI">
      <button onclick="onSave()">SAVE</button>
      <button onclick="onLoad()">LOAD</button>
    </div>
    <script>
      var EditorSetting = {
        bg: './img/room.jpg',
        bgColor: 0xaaaaaa,
        aeraSetting: {
          lineColor: 0xff00ff,
          fillColor: 0xff00ff,
          tagStyle: { fill: 0xffffff, bg: 0x000000 },
        },
      }
      var Editor = document.getElementById('Editor')

      function onReady() {
        //Editor tool onRready!
        postToEditor('setting', EditorSetting)
      }

      function onSave() {
        postToEditor('getAreaMeta')
      }

      function onLoad() {
        var meta = sessionStorage.getItem('tree')
        meta = meta && JSON.parse(meta)
        meta && postToEditor('setAreaMeta', meta)
      }

      Editor.contentWindow.addEventListener('message', function(e) {
        var data = e.data
        var meta
        if (data && data.app === 'TrackEditorTool') {
          switch (data.message && data.message.type) {
            case 'ready':
              onReady()
              break
            case 'areaData':
              meta = data.message.data
              if (meta.error) {
                alert(meta.error)
              } else {
                sessionStorage.setItem('tree', JSON.stringify(meta))
                alert('存檔成功')
              }
              break
          }
        }
      })
      function postToEditor(type, data) {
        Editor.contentWindow.postMessage(
          {
            target: 'TrackEditorTool',
            message: {
              type,
              data,
            },
          },
          '*',
        )
      }
    </script>
  </body>
</html>
